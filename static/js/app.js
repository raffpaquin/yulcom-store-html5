// Generated by CoffeeScript 1.6.3
(function(){var e,t,n,r,i,s,o,u,a;window.app={debug:!1,collections:{},models:{},views:{}};u=window.app;e=window.$;a=window._;n=window.Backbone;s=window.Modernizr;r=window.Handlebars;a.extend(u,n.Events);u.init=function(e){e==null&&(e={});this.config=e;return this};o=n.View.extend({el:e("#content"),ressources:{template:null,template_isLoaded:!1,data:null,data_isLoaded:!1},initialize:function(){return this.render()},load:function(t){e("body").addClass("loading");this.ressources.template=null;this.ressources.template_isLoaded=!1;this.ressources.data_isLoaded=!1;if(t.menu){e("ul.menu li").removeClass("active");e("ul.menu li[data-href="+t.menu+"]").addClass("active")}if(t.template){this.ressources.template=t.template;u.template.loadTemplateHtml(t.template,function(e){u.views.page.ressources.template_isLoaded=!0;return u.views.page.render()})}else this.template_loaded=!0;if(t.data){t.data.success=function(e){u.views.page.ressources.data=e;u.views.page.ressources.data_isLoaded=!0;return e.status==="error"?u.controller.redirect("/"):u.views.page.render()};t.data.error=function(e){return alert("error loading ajax ressources")};u.api.post(t.data)}else this.ressources.data_isLoaded=!0;return this.render()},render:function(){if(this.ressources.template_isLoaded&&this.ressources.data_isLoaded){this.$el.html(u.template.render(this.ressources.template,this.ressources.data));e("body").removeClass("loading");return e("body").scrollTop(0)}}});u.template={engines:[],requested:[],callback:{},render:function(e,t){if(this.engines[e]){console.log(t);return this.engines[e](t)}return alert("Unknow Template Engine")},block:function(t,n){var r,i;i=this.render(t);r=e(n);r.html(i);return!0},loadTemplateHtml:function(t,n){if(!this.engines[t]){if(!this.requested[t]){this.requested[t]=!0;this.callback[t]=[n];return e.ajax({url:"/static/template/"+t+".mustache",context:{engines:this.engines,template_id:t,callback:this.callback},success:function(e){var t,i,s,o;this.engines[this.template_id]=r.compile(e);s=this.callback[this.template_id];o=[];for(t=0,i=s.length;t<i;t++){n=s[t];o.push(n())}return o},cache:!0,dataType:"html"})}return this.callback[t].push(n)}return n()}};r.registerHelper("round",function(e){return Math.round(e)});r.registerHelper("money",function(e){var t;e=parseFloat(e);if(e>=0)return"$"+e.toFixed(2);t=-1*e;return"$"+t.toFixed(2)+""});r.registerHelper("time",function(e){return window.moment(e*1e3).from()});e(function(){return e("body").on("click","[data-action]",function(t){var n,r,i,s;n=e(this);i=n.attr("data-action").split("|");r=i[0];s=i[1]!=null?i[1]:"body";if(!r||r==="")return!1;u.views.menu.nav.destroy();u.trigger(r,{scope:s,cta:this});t.preventDefault();return!1})});e(function(){u.on("all",u.analytics.trackEvent);return u.controller.on("all",u.analytics.trackPageView)});u.analytics={trackEvent:function(e){},trackPageView:function(e){}};u.api={defaults:{url:"http://local.api.yulcom.ca/v1.0/terminal/"},post:function(t){t.data&&typeof t.data=="string"&&(t.data=this.stringToJson(t.data));t.url=this.defaults.url+t.url;t.dataType="json";t.beforeSend=function(t){e("#progress").stop();e("#progress").animate({width:"0%"},0);if(u.models.customer.credentials[0]&&u.models.customer.credentials[1])return t.setRequestHeader("Authorization","Basic "+window.btoa(u.models.customer.credentials.join(":")))};t.xhr=function(){var t;t=e.ajaxSettings.xhr();if(t instanceof window.XMLHttpRequest){t.upload&&t.upload.addEventListener("progress",function(t){var n;if(t.lengthComputable){n=t.loaded/t.total*100;return e("#progress").animate({width:percentage+"%"},200)}},!1);t.addEventListener("progress",function(e){var t;if(e.lengthComputable)return t=e.loaded/e.total*100},!1)}return t};t.complete=function(){e("#progress").stop();return e("#progress").animate({width:"100%"},300)};e.ajax(t);return!0},stringToJson:function(e){return JSON.parse('{"'+decodeURIComponent(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/\=/g,'":"')+'"}')}};u.cookies={read:function(e){var t,n;e==null&&(e="");t=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)");n=t.exec(document.cookie);return n!=null?n[1]:!1},write:function(e,t,n){var r,i;t==null&&(t="");n==null&&(n=360);i=new Date;i.setDate(i.getDate()+n);r=escape(t);n!=null&&(r=r+"; expires="+i.toUTCString());document.cookie=e+"="+r;return!0},"delete":function(e){return document.cookie=encodeURIComponent(e)+"=deleted; expires="+(new Date(0)).toUTCString()}};u.validator={validateSizes:function(t){var n,r;r=e(".btn-size a",t.scope);if(r.length>0){n=e(".btn-size a.active",t.scope);if(n.length<=0){e(".alert",t.scope).first().text("Please select a size").show(0);return!1}e(".alert",t.scope).first().text("").hide(0)}return!0}};i=n.Model.extend();u.checkout={goTo:function(t){e(".checkout-panel").animate({opacity:0,left:"-200px"},200,"swing",function(){e(".checkout-panel li").hide(0);e(".checkout-progress li").removeClass("active");e(".checkout-progress li.progress-"+t).addClass("active");e(".checkout-panel li.step-"+t).show(0);e(".checkout-panel").css({left:"200px"});return e(".checkout-panel").animate({opacity:1,left:0},200)});return!0}};t=n.Router.extend({_page:null,routes:{"login(/)":"login","products(/)":"product","products/:key(/)":"product-view","cart(/)":"cart","checkout(/)":"checkout","help(/)":"help","profil(/)":"profil","error(/)(:number)":"error","logout(/)":"logout","":"home",":path":"error"},initialize:function(){return u.views.page=new o},load:function(e){return u.views.page.load(e)},reload:function(){n.history.stop();return n.history.start()},redirect:function(e){return u.controller.navigate(e,{trigger:!0})}});u.controller=new t;u.controller.on("route:home",function(){return u.views.page.load({template:"index",menu:"index"})});u.controller.on("route:login",function(){return u.views.page.load({template:"login",menu:"login"})});u.controller.on("route:product",function(){return u.views.page.load({template:"product/list",menu:"products"})});u.controller.on("route:product-view",function(){return u.views.page.load({template:"product/view",menu:"products"})});u.controller.on("route:cart",function(){return u.views.page.load({template:"cart/cart",menu:"cart"})});u.controller.on("route:checkout",function(){return u.views.page.load({template:"checkout/checkout",menu:"cart"})});u.controller.on("route:product-view",function(e){if(u.models.customer.isLogin())return u.views.page.load({template:"product/view",data:{url:"product/view",data:{id:e},type:"get"},menu:"product"})});u.controller.on("route:product-add",function(){if(u.models.customer.isLogin())return u.views.page.load({template:"product/add",menu:"product"})});u.controller.on("route:order",function(){if(u.models.customer.isLogin())return u.views.page.load({template:"order/index",data:{url:"order/list",type:"get"},menu:"order"})});u.controller.on("route:order-view",function(e){if(u.models.customer.isLogin())return u.views.page.load({template:"order/view",data:{url:"order/view",data:{id:e},type:"get"},menu:"order"})});u.controller.on("route:promotion",function(){if(u.models.customer.isLogin())return u.views.page.load({template:"promotion/index",data:{url:"coupon/list",type:"get"},menu:"promotion"})});u.controller.on("route:promotion-add",function(){if(u.models.customer.isLogin())return u.views.page.load({template:"promotion/add",menu:"promotion"})});u.controller.on("route:analytic",function(){if(u.models.customer.isLogin())return u.views.page.load({template:"analytic/index",menu:"analytic"})});u.controller.on("route:setting",function(){if(u.models.customer.isLogin())return u.views.page.load({template:"setting/index",menu:"setting"})});u.controller.on("route:home-redirect",function(){return u.controller.redirect("home")});u.controller.on("route:logout",function(){if(u.models.customer.isLogin())return u.models.customer.logout()});n.history.start({pushState:!0});e(function(){return e(".wrapper").on("click","a",function(t){var n;n=e(this).attr("href");if(n&&n.length>1&&n.substring(0,3)!=="tel"&&n.substring(0,4)!=="http"&&n!=="#nav"){u.controller.redirect(n);return t.preventDefault()}})})}).call(this);